{
	"type": 4,
	"name": "Map",
	"shortTableName": "Map",
	"detailsBadgeColor": "9acd32",
	"pages": [
		{
			"id": "dashboard",
			"type": "dashboard",
			"layoutId": "leftbar",
			"disabled": false,
			"default": 0,
			"forms": {
				"grid": {
					"modelId": "dashboard-grid",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1",
									"colspan": 1
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"text"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"left": {
					"modelId": "leftbar-dashboard",
					"grid": [
						{
							"cells": [
								{
									"cell": "c0"
								}
							],
							"section": ""
						},
						{
							"cells": [
								{
									"cell": "c1"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c0": {
							"model": "c0",
							"items": [
								"logo"
							]
						},
						"c1": {
							"model": "c1",
							"items": [
								"menu"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"supertop": {
					"modelId": "leftbar-top-dashboard",
					"grid": [
						{
							"cells": [
								{
									"cell": "c1"
								},
								{
									"cell": "c2"
								}
							],
							"section": ""
						}
					],
					"cells": {
						"c1": {
							"model": "c1",
							"items": [
								"expand_menu_button",
								"collapse_button",
								"breadcrumb"
							]
						},
						"c2": {
							"model": "c2",
							"items": [
								"simple_search",
								"username_button"
							]
						}
					},
					"deferredItems": [],
					"recsPerRow": 1
				},
				"top": {
					"modelId": "dashboard-top",
					"grid": [],
					"cells": {},
					"deferredItems": [],
					"recsPerRow": 1
				}
			},
			"items": {
				"breadcrumb": {
					"type": "breadcrumb"
				},
				"logo": {
					"type": "logo"
				},
				"menu": {
					"type": "menu"
				},
				"simple_search": {
					"type": "simple_search"
				},
				"username_button": {
					"type": "username_button",
					"items": [
						"userinfo_link",
						"logout_link",
						"adminarea_link"
					]
				},
				"userinfo_link": {
					"type": "userinfo_link"
				},
				"logout_link": {
					"type": "logout_link"
				},
				"adminarea_link": {
					"type": "adminarea_link"
				},
				"expand_menu_button": {
					"type": "expand_menu_button"
				},
				"collapse_button": {
					"type": "collapse_button"
				},
				"text": {
					"type": "text",
					"label": {
						"text": "<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <title>Ghana ‚Äî Stations Commission Status by Region</title>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <link\n    rel=\"stylesheet\"\n    href=\"https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css\"\n    crossorigin=\"anonymous\"\n  />\n  <style>\n    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#f6f8fb;color:#111827}\n    .wrap{padding:16px}\n    .title{margin:0 0 12px;font-size:20px;font-weight:800;display:flex;align-items:center;gap:8px}\n    .panel{display:grid;grid-template-columns:minmax(280px,1fr) 420px;gap:14px}\n    @media(max-width:1100px){.panel{grid-template-columns:1fr}}\n    #ghanaMap{height:560px;border:1px solid #e5e7eb;border-radius:12px;background:#fff}\n    .side{border:1px solid #e5e7eb;border-radius:12px;background:#fff;padding:12px}\n    .legend{display:flex;align-items:center;gap:8px;margin:8px 0 12px}\n    .sw{width:20px;height:12px;border-radius:2px;border:1px solid rgba(0,0,0,.15)}\n    .row{display:flex;justify-content:space-between;gap:12px;padding:6px 0;border-bottom:1px dashed #eef2f7}\n    .row:last-child{border-bottom:0}\n    .pill{display:inline-block;padding:.2rem .5rem;border-radius:999px;font-size:.8rem;font-weight:700;border:1px solid transparent}\n    .ok{background:#e6f4ea;color:#0f5132;border-color:#badbcc}\n    .bad{background:#fee2e2;color:#991b1b;border-color:#fecaca}\n    .note{color:#6b7280;font-size:12px}\n    .leaflet-tooltip{font-weight:600}\n  </style>\n</head>\n<body>\n  <div class=\"wrap\">\n    <h3 class=\"title\">üó∫Ô∏è Ghana ‚Äî Stations Commission Status by Region</h3>\n\n    <div class=\"panel\">\n      <div id=\"ghanaMap\"></div>\n\n      <aside class=\"side\">\n        <div class=\"legend\"><span class=\"sw\" style=\"background:#a50f15\"></span><small>&le; 40% in-commission</small></div>\n        <div class=\"legend\"><span class=\"sw\" style=\"background:#f16913\"></span><small>~ 60% in-commission</small></div>\n        <div class=\"legend\"><span class=\"sw\" style=\"background:#31a354\"></span><small>&ge; 85% in-commission</small></div>\n\n        <div class=\"row\"><span>Selected Region</span><strong id=\"selName\">‚Äî</strong></div>\n        <div class=\"row\"><span>Working</span><span><span class=\"pill ok\" id=\"selWorking\">0</span></span></div>\n        <div class=\"row\"><span>Out of Commission</span><span><span class=\"pill bad\" id=\"selOOC\">0</span></span></div>\n        <div class=\"row\"><span>Total Stations</span><strong id=\"selTotal\">0</strong></div>\n        <div class=\"row\"><span>In-Commission %</span><strong id=\"selPctW\">0%</strong></div>\n        <div class=\"row\"><span>OOC %</span><strong id=\"selPctO\">0%</strong></div>\n\n        <p class=\"note\" style=\"margin-top:10px\">Hover to preview, click to lock. Data reflects current station &amp; workshop state.</p>\n        <div id=\"selList\" style=\"margin-top:10px;max-height:250px;overflow:auto;font-size:13px\"></div>\n      </aside>\n    </div>\n  </div>\n\n  <script src=\"https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js\" crossorigin=\"anonymous\"></script>\n  <script>\n    // === Config: endpoints & files ===\n    const GEOJSON_URL = \"include/ghana_regions.geojson\"; // must have property 'shapeName'\n    const DATA_URL    = \"api/commission-stats.php\";      // JSON from the PHP endpoint below\n\n    // === Small helpers ===\n    function esc(s){return String(s==null?'':s).replace(/&/g,'&amp;').replace(/</g,'&lt;')\n      .replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#039;');}\n\n    // Normalizer: mirror of server-side (uppercase, drop \"REGION\", strip spaces & punctuation)\n    function normName(s){\n      return String(s||'')\n        .toUpperCase()\n        .replace(/[&/\\\\.\\-_]/g,' ')\n        .replace(/\\bREGION\\b/g,'')\n        .replace(/\\s+/g,'')\n        .replace(/[^A-Z]/g,'');\n    }\n\n    // Tiny Levenshtein for fuzzy fallback (‚â§25% of name length)\n    function lev(a,b){\n      const m=a.length,n=b.length; if(!m) return n; if(!n) return m;\n      const dp=new Array(n+1); for(let j=0;j<=n;j++) dp[j]=j;\n      for(let i=1;i<=m;i++){\n        let prev=dp[0]; dp[0]=i;\n        for(let j=1;j<=n;j++){\n          const tmp=dp[j];\n          dp[j]=Math.min(dp[j]+1, dp[j-1]+1, prev+(a[i-1]===b[j-1]?0:1));\n          prev=tmp;\n        }\n      }\n      return dp[n];\n    }\n    function closestKey(query, dict){\n      const key = normName(query);\n      if(dict[key]) return key;\n      const keys = Object.keys(dict);\n      let best=null, bestDist=1e9;\n      for(const k of keys){ const d=lev(key,k); if(d<bestDist){best=k; bestDist=d;} }\n      const maxAllowed = Math.ceil(Math.max(key.length, (best||'').length) * 0.25);\n      return (bestDist<=maxAllowed) ? best : null;\n    }\n\n    function colorFor(pct){\n      if(pct==null) return '#d9d9d9';\n      if(pct<40) return '#a50f15';\n      if(pct<60) return '#f16913';\n      if(pct<75) return '#f1c40f';\n      if(pct<85) return '#7fc97f';\n      return '#31a354';\n    }\n\n    const el = {\n      name: document.getElementById('selName'),\n      w:    document.getElementById('selWorking'),\n      o:    document.getElementById('selOOC'),\n      t:    document.getElementById('selTotal'),\n      pw:   document.getElementById('selPctW'),\n      po:   document.getElementById('selPctO'),\n      list: document.getElementById('selList')\n    };\n    function setPanel(st){\n      if(!st){ el.name.textContent='‚Äî'; el.w.textContent='0'; el.o.textContent='0';\n               el.t.textContent='0'; el.pw.textContent='0%'; el.po.textContent='0%'; el.list.innerHTML=''; return; }\n      el.name.textContent = st.name||'‚Äî';\n      el.w.textContent    = String(st.working||0);\n      el.o.textContent    = String(st.ooc||0);\n      el.t.textContent    = String(st.total||0);\n      el.pw.textContent   = (st.pct_working!=null?Number(st.pct_working).toFixed(1):'0.0')+'%';\n      el.po.textContent   = (st.pct_ooc!=null?Number(st.pct_ooc).toFixed(1):'0.0')+'%';\n      el.list.innerHTML   = (st.stations||[]).slice().sort((a,b)=>(a.station||'').localeCompare(b.station||''))\n        .map(s=>`<div style=\"padding:6px 0;border-bottom:1px solid #f5f5f5\">\n                   <div><b>${esc(s.station||'')}</b> ‚Äî <small>${esc(s.status||'')}</small></div>\n                   <div class=\"note\">Vehicle: ${esc(s.vehicle||'‚Äî')} ¬∑ Avail: ${esc(s.avail||'')}</div>\n                 </div>`).join('');\n    }\n\n    // === Load data + draw map ===\n    Promise.all([ fetch(GEOJSON_URL).then(r=>r.json()), fetch(DATA_URL).then(r=>r.json()) ])\n      .then(([geo, stats])=>{\n        // stats should be { normName: { name, total, working, ooc, pct_working, pct_ooc, stations[] } }\n        const nameStats = stats || {};\n\n        const map = L.map('ghanaMap',{zoomControl:true,attributionControl:false}).setView([7.95,-1.03],6);\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);\n\n        const layer = L.geoJSON(geo, {\n          style: f=>{\n            const nm = f.properties.shapeName || f.properties.ShapeName || f.properties.name || '';\n            let k = normName(nm);\n            if(!nameStats[k]) k = closestKey(nm, nameStats) || k;\n            const st = nameStats[k] || null;\n            return { color:'#8e8e8e', weight:1, fillColor:colorFor(st?st.pct_working:null), fillOpacity:0.85 };\n          },\n          onEachFeature: (feature, lyr)=>{\n            const nm = feature.properties.shapeName || feature.properties.ShapeName || feature.properties.name || '';\n            let k = normName(nm);\n            if(!nameStats[k]) k = closestKey(nm, nameStats) || k;\n            const st = nameStats[k] || null;\n\n            const tip = st\n              ? `${esc(st.name)}<br>Working: <b>${st.working}</b> ¬∑ OOC: <b>${st.ooc}</b><br>In-Comm: <b>${st.pct_working}%</b> ¬∑ Total: <b>${st.total}</b>`\n              : `${esc(nm)}<br><i>No matching data</i>`;\n            lyr.bindTooltip(tip,{sticky:true});\n            lyr.on({\n              mouseover: e=>e.target.setStyle({weight:3}),\n              mouseout:  e=>e.target.setStyle({weight:1}),\n              click:     e=>setPanel(st)\n            });\n          }\n        }).addTo(map);\n\n        try{ map.fitBounds(layer.getBounds(), {padding:[10,10]}); }catch(e){}\n      })\n      .catch(err=>{\n        console.error('Load failed', err);\n        alert('Failed to load map or data. Check console and file paths.');\n      });\n  </script>\n</body>\n</html>\n",
						"type": 0
					},
					"editedByRte": false
				}
			},
			"dbProps": {},
			"version": 13,
			"imageItem": {
				"type": "page_image"
			},
			"imageBgColor": "#f2f2f2",
			"controlsBgColor": "white",
			"imagePosition": "right",
			"listTotals": 1,
			"title": {}
		}
	],
	"geoCoding": {
		"enabled": false,
		"latField": "",
		"lonField": "",
		"addressFields": []
	},
	"caption": {
		"English": "Map"
	}
}